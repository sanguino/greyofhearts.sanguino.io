function initPreload(){if(Detector.webgl){for(prepareInterfaz(),manifest=[],manifest.push(RUTA_FONDO),manifest.push(RUTA_DUST1),manifest.push(Modernizr.audio.ogg?RUTA_HEART_OGG:Modernizr.audio.mp3?RUTA_HEART_MP3:RUTA_HEART_M4A),manifest.push(RUTA_DUST2),manifest.push(RUTA_DUST3),manifest.push(RUTA_DUST4),manifest.push(RUTA_DUST5),manifest.push(Modernizr.audio.ogg?RUTA_MUSICA_OGG:Modernizr.audio.mp3?RUTA_MUSICA_MP3:RUTA_MUSICA_M4A),manifest.push(RUTA_CORAZON_PEQUE),manifest.push(RUTA_LOGO),manifest.push(RUTA_LUPA),manifest.push(RUTA_CORAZON_GRANDE),manifest.push(RUTA_PERFIL),manifest.push(RUTA_VERTICES_JSON),manifest.push(RUTA_DATOS_JSON),manifest.push(RUTA_CORAZON_GRANDE_DAE),preload=new createjs.LoadQueue(!0,""),preload.on("fileload",handleFileLoad),preload.on("progress",handleOverallProgress),preload.on("error",handleFileError),preload.on("complete",handleComplete,this),preload.setMaxConnections(5);manifest.length>0;)loadAnother();animaPreload()}else Detector.addGetWebGLMessage()}function loadAnother(){var e=manifest.shift();preload.loadFile(e)}function handleFileLoad(e){if(e.item.id==RUTA_DATOS_JSON){aPersonas=$.parseJSON(e.rawResult).personalGREY.personal,aPersonas.length>MAX_PARTICLES&&(MAX_PARTICLES=aPersonas.length);for(var a=0;a<aPersonas.length;a++)aPersonas[a].numPulsaciones=parseInt(aPersonas[a].numPulsaciones),aPersonas[a].numPulsaciones=Math.max(MIN_PULSACIONES,aPersonas[a].numPulsaciones),aPersonas[a].numPulsaciones=Math.min(MAX_PULSACIONES,aPersonas[a].numPulsaciones),totalPulsaciones+=aPersonas[a].numPulsaciones,aPersonas[a].txBuscar=aPersonas[a].txNombre+" "+aPersonas[a].txDepartamento+" "+aPersonas[a].txEmpresa,aPersonas[a].txBuscar=replaceChars(aPersonas[a].txBuscar.toLowerCase());$("#textoLema, #introMovil p").html(TEXTO_LEMA_INIT+formatNumber(totalPulsaciones)+TEXTO_LEMA_FIN),mediaPulsaciones=Math.round(totalPulsaciones/aPersonas.length)}e.item.id==RUTA_VERTICES_JSON&&(vertexData=$.parseJSON(e.rawResult))}function formatNumber(e){e=e.toString();for(var a=new RegExp("(-?[0-9]+)([0-9]{3})");a.test(e);)e=e.replace(a,"$1.$2");return e}function handleFileProgress(e){trace(e.item.id+" -> "+e.progress)}function handleOverallProgress(){preloadReal=100*preload.progress}function handleFileError(e){trace("error preload ->"+e.item.id)}function handleComplete(){}function animaPreload(){preloadReal>preloadSmooth&&preloadSmooth++,$("#info").html(preloadSmooth+" %"),100>preloadSmooth?setTimeout(animaPreload,1e3/60):TweenMax.to($("#info, #preload"),1,{autoAlpha:0,onComplete:initAll})}function initAll(){Modernizr.mobile||initAudio(),init3D(),animate()}function trace(e){DEBUG&&console.log(e)}function encode_utf8(e){return unescape(encodeURIComponent(e))}function decode_utf8(e){return decodeURIComponent(escape(e))}function replaceChars(e){return e=e.replace(/á/g,"a"),e=e.replace(/é/g,"e"),e=e.replace(/í/g,"i"),e=e.replace(/ó/g,"o"),e=e.replace(/ú/g,"u"),e=e.replace(/à/g,"a"),e=e.replace(/è/g,"e"),e=e.replace(/ì/g,"i"),e=e.replace(/ò/g,"o"),e=e.replace(/ù/g,"u")}function playIntro(){if(Modernizr.mobile)introMovil();else{if(Modernizr.localstorage&&"visitado"==localStorage.getItem("introVista"))return void finIntro();var e=0;TweenMax.to($("#intro"),0,{autoAlpha:1,display:"block",delay:0}),TweenMax.to($("#intro h1"),0,{autoAlpha:0,delay:0}),TweenMax.to($(".t1, .t2, .t3"),.5,{autoAlpha:1,delay:.8+e}),TweenMax.to($(".t1, .t2, .t3"),.5,{autoAlpha:0,delay:3.8+e}),TweenMax.to($(".t4"),.5,{autoAlpha:1,delay:1.5+e}),TweenMax.to($(".t4"),.5,{autoAlpha:0,delay:3.8+e}),TweenMax.to($(".t5, .t6, .t7"),.5,{autoAlpha:1,delay:4.5+e}),TweenMax.to($(".t5, .t6, .t7"),.5,{autoAlpha:0,delay:7.9+e}),TweenMax.to($(".t8"),.5,{autoAlpha:1,delay:5+e}),TweenMax.to($(".t8"),.5,{autoAlpha:0,delay:7.9+e}),TweenMax.to($(".t9"),.5,{autoAlpha:1,delay:8.8+e}),TweenMax.to($(".t9"),.5,{autoAlpha:0,delay:11.1+e}),TweenMax.to($(".t10"),.5,{autoAlpha:1,delay:9.3+e}),TweenMax.to($(".t10"),.5,{autoAlpha:0,delay:11.1+e,onComplete:finIntro})}}function introMovil(){TweenMax.to($("#introMovil"),0,{autoAlpha:0}),TweenMax.to($("#introMovil"),1,{autoAlpha:1,display:"block",delay:0})}function finIntro(){Modernizr.mobile?(TweenMax.to($("#introMovil"),1,{autoAlpha:0,display:"none",delay:1}),$("#introMovil").css("pointer-events","none"),initAudio(),setTimeout(finIntroDos,2e3)):finIntroDos()}function finIntroDos(){TweenMax.to($("#intro"),0,{autoAlpha:1,display:"none",delay:0}),createObjects(),initInterfaz(),createParticles(),Modernizr.localstorage&&localStorage.setItem("introVista","visitado")}function prepareInterfaz(){posInfoNombre=$("#infoNombre").css("margin-top"),posInfoPulsa=$("#infoPulsa").css("margin-top"),posBuscador=$("#buscar").css("margin-top"),posLema=$("#textoLema").css("margin-top"),TweenMax.to($("#infoNombre"),0,{marginTop:-500}),TweenMax.to($("#buscar"),0,{marginTop:-500}),TweenMax.to($("#infoPulsa"),0,{marginTop:window.innerHeight+500}),TweenMax.to($("#infoPulsa #animaPulsa"),0,{backgroundPosition:"0 0"}),TweenMax.to($("#buscador"),0,{width:"0px"}),TweenMax.to($("#buscar #cerrar"),0,{width:"0px"}),$("#buscador").on("input",cambiaBuscar),$("#buscar #cerrar span").on("mousedown",cerrarBuscador),TweenMax.to($("#textoLema"),0,{autoAlpha:0}),Modernizr.mobile?(TweenMax.to($("#buscador"),0,{width:"200px",paddingLeft:"35px",ease:Cubic.easeOut}),TweenMax.to($("#buscar #cerrar"),0,{display:"none"}),$("#buscador").css("cursor","text"),searchOpen=!0,$("#buscar").show()):($("#buscador").on("focus",abrirBuscador),$("#buscador").on("blur",blurBuscador),$("#buscar").show())}function abrirBuscador(){inSearch||Modernizr.mobile||(TweenMax.to($("#buscador"),1,{width:"200px",paddingLeft:"35px",ease:Cubic.easeOut}),$("#buscador").css("cursor","text"),TweenMax.to($("#buscar #cerrar"),1,{display:"block",width:"242px",ease:Cubic.easeOut}),searchOpen=!0)}function blurBuscador(){inSearch||cerrarBuscador()}function cerrarBuscador(){""!=$("#buscador").val()&&($("#buscador").val(""),cambiaBuscar()),Modernizr.mobile||(TweenMax.to($("#buscador"),1,{width:"0px",paddingLeft:"25px",ease:Cubic.easeOut}),$("#buscador").css("cursor","pointer"),TweenMax.to($("#buscar #cerrar"),1,{display:"none",width:"0px",ease:Cubic.easeOut}),searchOpen=!1)}function cambiaBuscar(){var e=$("#buscador").val().toLowerCase();if(e=replaceChars(e),estado!=AT_ZOOM&&oldBusqueda!=e){numFound=0;for(var a=0;a<particles.geometry.vertices.length;a++){var t=particles.geometry.vertices[a];e.length<=SEARCH_MIN_CHARS?(t.found=!0,numFound++):t.persona.txBuscar.indexOf(e)>-1&&a<aPersonas.length?(t.found=!0,numFound++):t.found=!1}e.length>SEARCH_MIN_CHARS?(activaLatidos=!1,escondePulso()):(activaLatidos=!0,muestraPulso(mediaPulsaciones,0)),inSearch=!activaLatidos,oldBusqueda=e}}function initInterfaz(){setTimeout(function(){esconderTodo(),muestraBuscar(),muestraPulso(mediaPulsaciones,.4),Modernizr.mobile?intervaloBuscar=setInterval(cambiaBuscar,1e3):TweenMax.to($("#textoLema"),1,{autoAlpha:1})},2e3)}function meterInfo(e,a,t,o,n){esconderTodo(),meterInfoTimeout=setTimeout(function(){entrarInfo(e,a,t,o,n)},600)}function entrarInfo(e,a,t,o,n){TweenMax.killAll(!0),$("#infoNombre #textoPersona").html(e),$("#infoNombre #textoEmpresa").html(t),$("#infoNombre #textoDepartamento").html(a),$("#infoNombre #fotoPersona").css("background-image","url('"+o+"')"),muestraNombre(),muestraPulso(n,0),cambiaURL(e,n)}function quitarInfo(){esconderTodo(),muestraBuscar(),inSearch||muestraPulso(mediaPulsaciones,.4),resetURL()}function esconderTodo(){clearTimeout(meterInfoTimeout),TweenMax.killAll(!0),escondeNombre(),escondeBuscar(),escondePulso()}function escondeNombre(){TweenMax.to($("#infoNombre"),1,{marginTop:-500,display:"none"})}function muestraNombre(){TweenMax.to($("#infoNombre"),1,{marginTop:posInfoNombre,ease:Cubic.easeOut,display:"block"})}function escondeBuscar(){TweenMax.to($("#buscar"),1,{marginTop:-500}),TweenMax.to($("#textoLema"),1,{marginTop:-500})}function muestraBuscar(){TweenMax.to($("#buscar"),1,{marginTop:posBuscador,ease:Cubic.easeOut,delay:.4}),TweenMax.to($("#textoLema"),1,{marginTop:posLema,ease:Cubic.easeOut,delay:.4})}function escondePulso(){TweenMax.to($("#infoPulsa"),1,{marginTop:window.innerHeight+500,display:"none"}),TweenMax.killTweensOf($("#infoPulsa #animaPulsa")),TweenMax.to($("#infoPulsa #animaPulsa"),0,{backgroundPosition:"0 0"})}function muestraPulso(e,a){TweenMax.to($("#infoPulsa"),1,{marginTop:posInfoPulsa,ease:Cubic.easeOut,display:"block",delay:a}),TweenMax.to($("#infoPulsa #animaPulsa"),60/parseInt(e),{backgroundPosition:"-60px 0",repeat:-1,ease:Linear.easeNone}),$("#infoPulsa #numPulsa").html(e)}function cambiaURL(e,a){var t=e.replace(/\s/g,"")+"_"+a;window.history.pushState(t,$(document).find("title").text(),"/"+t)}function resetURL(){window.history.pushState("",$(document).find("title").text(),"/")}function initAudio(){for(musica=new Audio,musica.src=Modernizr.audio.ogg?RUTA_MUSICA_OGG:Modernizr.audio.mp3?RUTA_MUSICA_MP3:RUTA_MUSICA_M4A,musica.loop=!0,musica.volume=.2,musica.play(),latidoIndex=0;3>latidoIndex;latidoIndex++)latidos[latidoIndex]=new Audio,latidos[latidoIndex].src=Modernizr.audio.ogg?RUTA_HEART_OGG:Modernizr.audio.mp3?RUTA_HEART_MP3:RUTA_HEART_M4A,latidos[latidoIndex].volume=.01,latidos[latidoIndex].play();latidoIndex=0}function playHeart(){(activaLatidos||estado==AT_ZOOM)&&(latidos[latidoIndex].volume=.8,latidos[latidoIndex].play(),latidoIndex++,latidoIndex>=3&&(latidoIndex=0)),webIsActive&&(clearTimeout(timeoutLatidos),timeoutLatidos=setTimeout(playHeart,timePerBeat))}function pauseSound(){musica&&musica.pause()}function replaySound(){musica&&(musica.play(),playHeart())}function checkRay(e,a){vertexSelected=null;var t=CLICK_DIST_MIN,o=MAX_PARTICLES;for(estado==AT_SEARCH&&(o=aPersonas.length),i=0;o>i;i++){var n=particles.geometry.vertices[i].clone().project(camera),r=500*Math.sqrt(Math.pow(n.x-e,2)+Math.pow(n.y-a,2));t>r&&(!inSearch||particles.geometry.vertices[i].found)&&(t=r,vertexSelected=particles.geometry.vertices[i])}hacerZoom()}function hacerZoom(){null!=vertexSelected&&estado!=AT_ZOOM?(meterInfo(vertexSelected.persona.txNombre,vertexSelected.persona.txDepartamento,vertexSelected.persona.txEmpresa,vertexSelected.persona.txImagen,vertexSelected.persona.numPulsaciones),cameraTarget=vertexSelected,activaLatidos=!1,corazon.position.x=vertexSelected.x,corazon.position.y=vertexSelected.y,corazon.position.z=CORAZON_Z_DETRAS):(null!=cameraTarget&&quitarInfo(),cameraTarget=null)}function loop(){corazon&&(setEstado(),setTiempo(),animateCamera(divEase),animateParticulas(),animateCorazon(divEase),particles.geometry.verticesNeedUpdate=!0)}function animateParticulas(){for(i=0;i<particles.geometry.vertices.length;i++){var e=particles.geometry.vertices[i];estado==AT_HOME?loopVertex_Home(e):estado==AT_ZOOM?loopVertex_Zoom(e):loopVertex_Search(e)}}function animateCamera(e){estado==AT_HOME?(activaLatidos=!0,animateCamera_Home(e)):estado==AT_ZOOM?animateCamera_Zoom(e):animateCamera_Search(e),camera.lookAt(cameraLookAtPoint)}function animateCorazon(e){estado==AT_SEARCH&&null!=vertexSelected?animateCorazon_Search(e):estado==AT_ZOOM?animateCorazon_Zoom(e):animateCorazon_Home(e)}function setTiempo(){time=Date.now()-oldTime,oldTime=Date.now(),time=Math.min(500,time),divEase=60*time/1e3,timePerBeat+=vertexSelected&&estado==AT_ZOOM?(60/vertexSelected.persona.numPulsaciones*1e3-timePerBeat)/20*divEase:(60/mediaPulsaciones*1e3-timePerBeat)/20*divEase,anglePerMilisec=360/timePerBeat*Math.PI/180,timeBeat+=time*anglePerMilisec}function setEstado(){estado=null!=cameraTarget||inSearch?null!=cameraTarget?AT_ZOOM:AT_SEARCH:AT_HOME}function animateDust(){var e=5e-5*Date.now();for(i=0;i<dustParticles.length;i++)dustParticles[i].rotation.y=e*(4>i?i+1:-(i+1)),dustParticles[i].position.x+=.01*(.2*mouseX-dustParticles[i].position.x),dustParticles[i].position.y+=.05*(-0.2*mouseY-dustParticles[i].position.y)}function createObjects(){var e=new THREE.ColladaLoader;for(e.options.convertUpAxis=!0,e.load(RUTA_CORAZON_GRANDE_DAE,completeCorazon),sprite=THREE.ImageUtils.loadTexture(RUTA_CORAZON_PEQUE),material=new THREE.PointCloudMaterial({size:TAM_PARTICULA,map:sprite,blending:THREE.AdditiveBlending,depthTest:!1,transparent:!0,opacity:CORAZON_PEQUE_OPACITY_DETRAS}),particles=new THREE.PointCloud(new THREE.Geometry,material),particles.renderDepth=200,i=0;MAX_PARTICLES>i;i++){var a=new THREE.Vector3;a.z=-1e4,particles.geometry.vertices.push(a)}scene.add(particles)}function completeCorazon(e){var a=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(RUTA_CORAZON_GRANDE),transparent:!0});dae=e.scene,dae.updateMatrix(),corazon=dae.children[0],corazon.rotation.y=-90*Math.PI/180,corazon.children[0].material=a,corazon.scale.set(CORAZON_SCALE,CORAZON_SCALE,CORAZON_SCALE),corazon.children[0].material.opacity=0,corazon.renderDepth=100,scene.add(corazon),onWindowResize()}function createParticles(){for(i=0;i<Math.min(MAX_PARTICLES/100);i++)MAX_PARTICLES>partCreated&&createParticle();MAX_PARTICLES>partCreated?setTimeout(createParticles,10):allParticlesCreated()}function allParticlesCreated(){if(""!=userLoad){var e=userLoad.split("_"),a=e[e.length-1],t="";for(i=0;i<e.length-1;i++)i>0&&(t+="_"),t+=e[i];for(vertexSelected=null,i=0;i<aPersonas.length;i++){var o=particles.geometry.vertices[i].persona.txNombre.replace(/\s/g,"");o==t&&particles.geometry.vertices[i].persona.numPulsaciones==a&&(vertexSelected=particles.geometry.vertices[i])}setTimeout(function(){hacerZoom()},2*WAIT_TO_START)}else activaLatidos=!0;playHeart(),setTimeout(createListeners,WAIT_TO_START)}function createParticle(){vertex=particles.geometry.vertices[partCreated],vertex.ox=vertexData[partCreated].x,vertex.oy=vertexData[partCreated].y,vertex.oz=vertexData[partCreated].z,vertex.x=5e3*Math.random()-2500,vertex.y=5e3*Math.random()-2500,vertex.z=5e3*Math.random()-2500,vertex.animaAngle=Math.random()*Math.PI*2,vertex.sinVel=(.5*Math.random()+.5)*Math.random()<.5?-1:1,vertex.cosVel=(.5*Math.random()+.5)*Math.random()<.5?-1:1,vertex.axy=Math.atan2(vertex.oy,vertex.ox),vertex.axz=Math.atan2(vertex.oz,vertex.ox),vertex.dax=Math.sqrt(vertex.ox*vertex.ox+vertex.oy*vertex.oy),vertex.beatForce=5+(100*Math.random()+20)*vertex.dax/400,vertex.beatArritmia=Math.random()-.5,vertex.radioBeat=0,partCreated<aPersonas.length&&(aPersonas[partCreated].vertex=vertex),vertex.persona=aPersonas[partCreated%aPersonas.length],vertex.found=!0,vertex.delante=!0,partCreated++}function createDust(){for(dustGeom=new THREE.Geometry,dustParticles=[],dustMaterials=[],sprite1=THREE.ImageUtils.loadTexture(RUTA_DUST1),sprite2=THREE.ImageUtils.loadTexture(RUTA_DUST2),sprite3=THREE.ImageUtils.loadTexture(RUTA_DUST3),sprite4=THREE.ImageUtils.loadTexture(RUTA_DUST4),sprite5=THREE.ImageUtils.loadTexture(RUTA_DUST5),i=0;100>i;i++){var e=new THREE.Vector3;e.x=1e3*Math.random()-500,e.y=1e3*Math.random()-500,e.z=1e3*Math.random()-500,dustGeom.vertices.push(e)}for(parameters=[[[1,.2,.5],sprite2,20],[[.95,.1,.5],sprite3,15],[[.9,.05,.5],sprite1,10],[[.85,0,.5],sprite5,8],[[.8,0,.5],sprite4,5]],i=0;i<parameters.length;i++)color=parameters[i][0],spr=parameters[i][1],size=parameters[i][2]/1.5,dustMaterials[i]=new THREE.PointCloudMaterial({size:size,map:spr,blending:THREE.AdditiveBlending,depthTest:!1,transparent:!0}),dustMaterials[i].color.setHSL(color[0],color[1],color[2]),dustParticles[i]=new THREE.PointCloud(dustGeom,dustMaterials[i]),dustParticles[i].rotation.x=6*Math.random(),dustParticles[i].rotation.y=6*Math.random(),dustParticles[i].rotation.z=6*Math.random(),dustParticles[i].x=-500,dustParticles[i].z=-300,dustParticles[i].renderDepth=150,camera.add(dustParticles[i])}function loopVertex_Search(e){e.radioBeat+=(0-e.radioBeat)/10*divEase,e.found?(e.tx=e.ox/3+Math.cos(e.axy),e.ty=e.oy/3+Math.sin(e.axy)):(e.tx=e.ox/3+300*Math.cos(e.axy),e.ty=e.oy/3+300*Math.sin(e.axy)),e.animaAngle+=time/2e3,e.x+=(5*Math.sin(e.sinVel*e.animaAngle)+e.tx-e.x)/multiply*divEase,e.y+=(5*Math.cos(e.cosVel*e.animaAngle)+e.ty-e.y)/multiply*divEase,e.tz=e.oz/10+Math.sin(e.axz)*e.beatForce*e.radioBeat,e.z+=(e.tz-e.z)/20*divEase}function animateCamera_Search(e){camera.position.x+=.03*(0-camera.position.x)*e,camera.position.y+=.03*(0-camera.position.y)*e,camera.position.z+=(CAMERA_ZOOM_SEARCH-camera.position.z)/20*e,cameraLookAtPoint.x+=(0-cameraLookAtPoint.x)/10*e,cameraLookAtPoint.y+=(0-cameraLookAtPoint.y)/10*e,cameraLookAtPoint.z+=(0-cameraLookAtPoint.z)/10*e,particles.material.opacity+=(CORAZON_PEQUE_OPACITY_DETRAS-particles.material.opacity)/30*e,multiply+=(60-multiply)/20*e}function animateCorazon_Search(e){animateCorazon_Home(e)}function loopVertex_Zoom(e){e.radioBeat=0,e.radioBeat+=(0-e.radioBeat)/10*divEase,e.tx=e.ox+Math.cos(e.axy)*e.beatForce*e.radioBeat,e.ty=e.oy+Math.sin(e.axy)*e.beatForce*e.radioBeat,e.animaAngle+=time/2e3,e.x+=(20*Math.sin(e.sinVel*e.animaAngle)+e.tx-e.x)/20*divEase,e.y+=(20*Math.cos(e.cosVel*e.animaAngle)+e.ty-e.y)/20*divEase,e.tz=e.oz+Math.sin(e.axz)*e.beatForce*e.radioBeat,e.z+=(e.tz-e.z)/20*divEase}function animateCamera_Zoom(e){camera.position.x+=.03*(0-camera.position.x)*e,camera.position.y+=.03*(0-camera.position.y)*e,camera.position.z+=(CAMERA_ZOOM_IN-camera.position.z-corazon.position.z)/20*e,cameraLookAtPoint.x+=(corazon.position.x-cameraLookAtPoint.x)/10*e,cameraLookAtPoint.y+=(corazon.position.y-cameraLookAtPoint.y)/10*e,cameraLookAtPoint.z+=(corazon.position.z-cameraLookAtPoint.z)/10*e,particles.material.opacity+=(CORAZON_PEQUE_OPACITY_DELANTE-particles.material.opacity)/10*e,multiply+=(20-multiply)/20*e}function animateCorazon_Zoom(e){corazon.children[0].material.opacity+=(.9-corazon.children[0].material.opacity)/10*e;var a=Math.max(0,.8*Math.sin(timeBeat))+Math.max(0,Math.sin(timeBeat+2.5));tempPerBeatCorazon+=(8*CORAZON_SCALE+a/2-tempPerBeatCorazon)/20*e,corazon&&corazon.scale.set(tempPerBeatCorazon,tempPerBeatCorazon,tempPerBeatCorazon)}function loopVertex_Home(e){e.radioBeat=0,activaLatidos?e.radioBeat=2*Math.max(0,.8*Math.sin(timeBeat+e.beatArritmia))+Math.max(0,Math.sin(timeBeat+e.beatArritmia+2.5)):e.radioBeat+=(0-e.radioBeat)/10*divEase,e.tx=e.ox+Math.cos(e.axy)*e.beatForce*e.radioBeat,e.ty=e.oy+Math.sin(e.axy)*e.beatForce*e.radioBeat,e.animaAngle+=time/2e3,e.x+=(20*Math.sin(e.sinVel*e.animaAngle)+e.tx-e.x)/20*divEase,e.y+=(20*Math.cos(e.cosVel*e.animaAngle)+e.ty-e.y)/20*divEase,e.tz=e.oz+Math.sin(e.axz)*e.beatForce*e.radioBeat,e.z+=(e.tz-e.z)/20*divEase}function animateCamera_Home(e){searchOpen?(camera.position.x+=.03*(0-camera.position.x)*e,camera.position.y+=.03*(0-camera.position.y)*e):(camera.position.x+=.03*(CAMERA_MOVE_OUT*mouseX-camera.position.x)*e,camera.position.y+=.03*(-CAMERA_MOVE_OUT*mouseY-camera.position.y)*e),camera.position.z+=(CAMERA_ZOOM_OUT-camera.position.z)/20*e,cameraLookAtPoint.x+=(0-cameraLookAtPoint.x)/10*e,cameraLookAtPoint.y+=(0-cameraLookAtPoint.y)/10*e,cameraLookAtPoint.z+=(0-cameraLookAtPoint.z)/10*e,particles.material.opacity+=(CORAZON_PEQUE_OPACITY_DETRAS-particles.material.opacity)/30*e,multiply+=(20-multiply)/20*e}function animateCorazon_Home(e){tempPerBeatCorazon+=(CORAZON_SCALE/10-tempPerBeatCorazon)/10*e,corazon&&(corazon.scale.set(tempPerBeatCorazon,tempPerBeatCorazon,tempPerBeatCorazon),corazon.children[0].material.opacity+=(0-corazon.children[0].material.opacity)/10*e)}function init3D(){raycaster=new THREE.Raycaster,$("body").append('<div id="container"></div>'),TweenMax.to($("#container"),0,{autoAlpha:0}),TweenMax.to($("#container"),3,{autoAlpha:1}),camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,2e3),camera.position.z=1e3,scene=new THREE.Scene,scene.add(camera),createDust(),renderer=new THREE.WebGLRenderer({}),renderer.setSize(window.innerWidth,window.innerHeight),renderer.clear(),$(renderer.domElement).appendTo($("#container")),DEBUG&&(stats=new Stats,stats.domElement.style.position="absolute",stats.domElement.style.top="0px",$(stats.domElement).appendTo($("#container"))),window.addEventListener("blur",onDocumentBlur),window.addEventListener("focus",onDocumentFocus),window.addEventListener("resize",onWindowResize,!1);var e=THREE.ImageUtils.loadTexture(RUTA_FONDO),a=new THREE.MeshBasicMaterial({map:e});fondo=new THREE.Mesh(new THREE.PlaneGeometry(1280,872,4,4),a),fondo.material.depthTest=!1,fondo.material.depthWrite=!1,fondo.position.z=-300,camera.add(fondo),onWindowResize(),playIntro()}function createListeners(){var e;e=document.getElementById("container"),e.addEventListener("mousemove",onDocumentMouseMove,!1),e.addEventListener("mousedown",onDocumentMouseDown,!1),e.addEventListener("touchstart",onDocumentTouchStart,!1),e.addEventListener("touchend",onDocumentTouchEnd,!1),e.addEventListener("touchcancel",onDocumentTouchEnd,!1),e.addEventListener("touchmove",onDocumentTouchMove,!1)}function onWindowResize(){windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),corazon&&(corazon.children[0].position.y=-(80-window.innerHeight/25));var e=new THREE.Vector3;e.set(1,1,.5),e.unproject(camera),e.x*=170,e.y*=170;var a;a=e.x/e.y>1280/872?e.x/1280:e.y/872,fondo.scale.x=a,fondo.scale.y=a}function onDocumentMouseMove(e){mouseX=2*(e.clientX-windowHalfX)/window.innerWidth,mouseY=2*(e.clientY-windowHalfY)/window.innerHeight}function onDocumentMouseDown(e){posX=e.clientX/window.innerWidth*2-1,posY=2*-(e.clientY/window.innerHeight)+1,checkRay(posX,posY)}function onDocumentTouchStart(e){1===e.touches.length&&(e.preventDefault(),touchStartX=e.touches[0].pageX,touchStartY=e.touches[0].pageY,touchEndX=e.touches[0].pageX,touchEndY=e.touches[0].pageY)}function onDocumentTouchEnd(e){1===e.changedTouches.length&&(e.preventDefault(),Math.sqrt(Math.pow(touchStartX-touchEndX,2)+Math.pow(touchStartY-touchEndY,2))<5&&(posX=touchStartX/window.innerWidth*2-1,posY=2*-(touchStartY/window.innerHeight)+1,checkRay(posX,posY)))}function onDocumentTouchMove(e){1===e.touches.length&&(e.preventDefault(),touchX=e.touches[0].pageX-touchEndX,touchY=e.touches[0].pageY-touchEndY,touchEndX=e.touches[0].pageX,touchEndY=e.touches[0].pageY,mouseX+=3*-(touchX/window.innerWidth),mouseY+=3*-(touchY/window.innerHeight),mouseX=Math.max(-1,Math.min(mouseX,1)),mouseY=Math.max(-1,Math.min(mouseY,1)))}function onDocumentFocus(){oldTime=Date.now(),time=oldTime,webIsActive=!0,replaySound()}function onDocumentBlur(){webIsActive=!1,pauseSound()}function animate(){webIsActive?requestAnimationFrame(animate):setTimeout(animate,16),render(),DEBUG&&stats.update()}function render(){loop(),animateDust(),renderer.render(scene,camera)}var preload,loader,manifest,aPersonas,totalPulsaciones=0,mediaPulsaciones=0,preloadSmooth=0,preloadReal=0;$(document).ready(initPreload);var posInfoNombre,posInfoPulsa,posBuscador,posLema,inSearch=!1,numFound,searchOpen=!1,meterInfoTimeout,intervaloBuscar,oldBusqueda="",latidos=[],timeoutLatidos,latidoIndex,musica,TAM_PARTICULA=20,TAM_PARTICULA_SEARCH=65,ESCALA_CORAZON=30,MAX_PARTICLES=2e3,CAMERA_ZOOM_OUT=1e3,CAMERA_ZOOM_IN=-300,CAMERA_ZOOM_SEARCH=300,CAMERA_MOVE_OUT=600,CAMERA_MOVE_IN=10,CLICK_DIST_MIN=50,CORAZON_Z_DELANTE=100,CORAZON_Z_DETRAS=-600,CORAZON_SCALE=.2,CORAZON_PEQUE_OPACITY_DETRAS=.8,CORAZON_PEQUE_OPACITY_DELANTE=.3,WAIT_TO_START=600,SEARCH_MIN_CHARS=0,SEARCH_DETRAS_Z=-3e3,MAX_PULSACIONES=250,MIN_PULSACIONES=30,AT_SEARCH="AT_SEARCH",AT_ZOOM="AT_ZOOM",AT_HOME="AT_HOME",TEXTO_LEMA_INIT="Este coraz&oacute;n ha sido hecho desde los corazones de los empleados de Grey.<br>Ponemos ",TEXTO_LEMA_FIN=" latidos por minuto en todo lo que hacemos.",RUTA_FONDO="img/fondo-hiv2.jpg",RUTA_DUST1="img/dust/dust1.png",RUTA_DUST2="img/dust/dust2.png",RUTA_DUST3="img/dust/dust3.png",RUTA_DUST4="img/dust/dust4.png",RUTA_DUST5="img/dust/dust5.png",RUTA_CORAZON_PEQUE="img/corazon.png",RUTA_CORAZON_GRANDE="img/corazonuv.jpg",RUTA_LOGO="img/logo.png",RUTA_LUPA="img/lupa.png",RUTA_PERFIL="formulario/img/perfil.png",RUTA_CORAZON_GRANDE_DAE="obj/corazonuv.dae",RUTA_VERTICES_JSON="obj/vertices.json",RUTA_DATOS_JSON="ws/dameDatos.php",RUTA_MUSICA_OGG="audio/catalano.ogg",RUTA_MUSICA_MP3="audio/catalano.mp3",RUTA_MUSICA_M4A="audio/catalano.m4a",RUTA_HEART_OGG="audio/heart.ogg",RUTA_HEART_MP3="audio/heart.mp3",RUTA_HEART_M4A="audio/heart.m4a",particles,i,sprite,spriteSearch,partCreated=0,vertexData,timeBeat=0,timeBeatCorazon=0,activaLatidos=!1,cameraTarget=null,cameraLookAtPoint=new THREE.Vector3(0,0,0),corazon,divEase,multiply=20,tempPerBeatCorazon=CORAZON_SCALE,tempPerBeatCorazon2=CORAZON_SCALE,estado=AT_HOME,timePerBeat=2e3,anglePerMilisec,vertexSelected,camera,scene,renderer,fondo,dustGeom,dustParticles,dustMaterials,mouseX=0,mouseY=0,touchX=0,touchY=0,touchStartX=0,touchStartY=0,touchEndX=0,touchEndY=0,raycaster,windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,time,oldTime=Date.now(),webIsActive=!0;window.onfocus=onDocumentFocus,window.onblur=onDocumentBlur;
